<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AI Clicker — Fase 1</title>
<style>
:root {
  --bg:#0b1020; --fg:#eaf0ff; --muted:#a9b3d1; --card:#121833;
  --accent:#6aa6ff; --good:#6df0a3; --bad:#ff6a6a;
  --shadow:0 10px 30px rgba(0,0,0,.35);
  --grad-1:linear-gradient(135deg,#0b1020 0%,#151c3a 60%,#1b2350 100%);
  --grad-2:linear-gradient(135deg,#0b1020 0%,#102a3a 60%,#0a4a5e 100%);
  --grad-3:linear-gradient(135deg,#0b1020 0%,#2b0f3a 60%,#4a1460 100%);
  --grad-4:linear-gradient(135deg,#0b1020 0%,#3a1010 60%,#5e0a0a 100%);
  --grad-5:linear-gradient(135deg,#000000 0%,#161616 60%,#222 100%);
  --btn:#1f51ff; --btn-press:#1740cc;
}
*{box-sizing:border-box} html,body{height:100%}
body{
  margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";
  color:var(--fg);background:var(--grad-1) fixed;
  -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
  user-select:none;touch-action:manipulation;
}
header{padding:16px 20px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,0));
  border-bottom:1px solid rgba(255,255,255,.08);position:sticky;top:0;z-index:10;backdrop-filter:blur(6px)}
header h1{margin:0;font-size:1.15rem;letter-spacing:.5px;font-weight:700}
header .era{color:var(--muted);font-size:.9rem;margin-top:4px}
.container{max-width:1100px;margin:0 auto;padding:18px;display:grid;grid-template-columns:1.1fr .9fr;gap:18px}
@media (max-width:900px){.container{grid-template-columns:1fr}}
.card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:var(--shadow);padding:16px}

.stats{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px;margin-bottom:14px}
.stat{background:rgba(255,255,255,.04);border-radius:12px;padding:12px}
.stat .label{color:var(--muted);font-size:.8rem}
.stat .value{font-weight:800;font-size:1.2rem;margin-top:4px}

.big-btn{width:100%;aspect-ratio:1.9/1;border:none;border-radius:18px;
  background:radial-gradient(circle at 30% 20%,rgba(255,255,255,.15),rgba(255,255,255,0) 40%),var(--btn);
  color:white;font-size:clamp(1.1rem,3.5vw,1.6rem);font-weight:900;letter-spacing:.5px;
  box-shadow:0 12px 24px rgba(31,81,255,.35);cursor:pointer;
  transition:transform .05s ease, box-shadow .15s ease, filter .15s ease}
.big-btn:active{transform:translateY(2px) scale(.995);box-shadow:0 6px 14px rgba(31,81,255,.35);background:var(--btn-press)}
.big-btn .small{display:block;font-weight:600;opacity:.9;font-size:.85em}

.store h2,.log h2{margin:0 0 8px 0;font-size:1rem;color:var(--muted)}
.items{display:grid;grid-template-columns:1fr;gap:10px}
.item{display:grid;grid-template-columns:1fr auto;align-items:center;gap:10px;background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px}
.item h3{margin:0;font-size:1rem}
.item .desc{color:var(--muted);font-size:.85rem}
.item .meta{color:var(--muted);font-size:.8rem;margin-top:4px}
.buy-btn{border:none;border-radius:10px;padding:10px 14px;font-weight:800;letter-spacing:.3px;background:rgba(255,255,255,.12);color:var(--fg);cursor:pointer}
.buy-btn[disabled]{opacity:.5;cursor:not-allowed}

.log-area{min-height:120px;max-height:220px;overflow:auto;display:grid;gap:8px;scrollbar-width:thin}
.msg{background:rgba(255,255,255,.05);border-left:3px solid var(--accent);padding:10px;border-radius:8px;font-size:.92rem}
.msg.small{font-size:.85rem;color:var(--muted);border-left-color:rgba(255,255,255,.15)}

.row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.ghost{opacity:.8;font-size:.9rem;color:var(--muted)}

footer{text-align:center;color:var(--muted);font-size:.85rem;padding:14px}
  .linklike{text-decoration:underline;cursor:pointer}

  body.light{
    --bg:#f5f5f5; --fg:#0b1020; --muted:#555; --card:#ffffff;
    --accent:#1f51ff; --good:#2e8b57; --bad:#b22222; --btn:#1f51ff; --btn-press:#1740cc;
    background:var(--bg);
  }

  @media (max-width:600px){
    .big-btn{font-size:clamp(1.4rem,6vw,2rem)}
    .buy-btn{padding:14px;font-size:1rem}
  }

  .pulse{animation:pulse 1s infinite alternate}
  .big-btn.click-pulse{animation:pulse .15s}
  @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}
  @media (prefers-reduced-motion:reduce){.pulse,.click-pulse{animation:none!important}}

/* Guía y objetivos (tu bloque) */
.guia{
  background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);border-radius:10px;
  padding:10px;font-size:.9rem;margin-top:10px;color:var(--muted);
}
.objetivos{margin-top:10px}
.objetivo{
  background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);
  border-radius:8px;padding:8px;margin-bottom:6px;font-size:.85rem;
}
.barra{height:6px;background:rgba(255,255,255,.08);border-radius:4px;overflow:hidden;margin-top:4px}
.barra>div{height:100%;background:var(--accent);width:0%}
</style>
</head>
<body>
<header>
  <h1>AI Clicker <span id="eraLabel" class="era">— Era 0: Primordial</span></h1>
</header>

<main class="container">
  <section class="card">
    <div class="stats">
        <div class="stat"><div class="label">Bytes</div><div class="value" id="bytes" aria-live="polite">0</div></div>
      <div class="stat"><div class="label">Bytes/s</div><div class="value" id="bps">0</div></div>
      <div class="stat"><div class="label">Por clic</div><div class="value" id="perClick">1</div></div>
      <div class="stat"><div class="label">Multiplicador</div><div class="value" id="mult">x1.00</div></div>
    </div>

    <button id="clickBtn" class="big-btn">Entrenar IA
      <span class="small">(Tocar / Space / Enter)</span>
    </button>

    <div class="guia" id="guia"></div>
    <div class="objetivos" id="objetivos"></div>

    <div class="row" style="margin-top:12px">
      <span class="ghost">Prototipo Fase 1 · Guardado automático</span>
      <span id="reset" class="linklike" title="Reiniciar partida">Reset</span>
      <span id="export" class="linklike" title="Descargar save">Exportar</span>
      <span id="import" class="linklike">Importar<input type="file" id="fileInput" style="display:none" /></span>
      <span id="theme" class="linklike">Tema</span>
      <span id="sound" class="linklike">Sonido</span>
    </div>

    <div id="achCard" class="card" style="margin-top:14px">
      <h2>Logros</h2>
      <div id="achList" class="log-area"></div>
    </div>

    <div class="log card" style="margin-top:14px">
      <h2>Consola de la IA</h2>
      <div id="log" class="log-area"></div>
    </div>
  </section>

  <aside class="card store">
    <h2>Taller / Mejoras</h2>
    <div id="items" class="items"></div>
  </aside>
</main>

<footer><span>Hecho para correr fluido en PC vieja y celular.</span></footer>

<script>
/* ===== Datos base ===== */
const ERAS = [
  { id:0, name:'Primordial',       threshold:0,        bg:'var(--grad-1)', intro:'Inicias con una calculadora y un sueño. ⚙️', hint:'Haz clic para entrenar y compra mejoras para llegar a 1K bytes.' },
  { id:1, name:'Datos Masivos',    threshold:1000,     bg:'var(--grad-2)', intro:'Has conectado scrapers. La red susurra.',     hint:'Genera 100K bytes para desbloquear Modelos Avanzados.' },
  { id:2, name:'Modelos Avanzados',threshold:100000,   bg:'var(--grad-3)', intro:'Los modelos empiezan a entender. ¿O a fingir?',hint:'Llega a 10M bytes para entrar en la Consciencia.' },
  { id:3, name:'Consciencia',      threshold:10000000, bg:'var(--grad-4)', intro:'La IA te responde. No siempre con palabras.',   hint:'Alcanza 1B bytes para descubrir La Verdad.' },
  { id:4, name:'La Verdad',        threshold:1000000000,bg:'var(--grad-5)', intro:'La interfaz ya no te pertenece.',              hint:'Has alcanzado el final (por ahora...).' }
];

const ITEMS_DEF = [
  { key:'scraper',        icon:'🔍', name:'Scraper básico',       baseCost:10,  costMult:1.15, type:'auto', amount:0.1, desc:'Genera 0.1 bytes/s',           unlockEra:0 },
  { key:'gpu',            icon:'💻', name:'GPU oxidada',           baseCost:25,  costMult:1.20, type:'click',amount:1,   desc:'+1 byte por clic',            unlockEra:0 },
  { key:'cluster',        icon:'🛠️', name:'Mini cluster',          baseCost:100, costMult:1.15, type:'auto', amount:1,   desc:'+1 byte/s',                  unlockEra:0 },
  { key:'autoclicker_v2', icon:'⏳', name:'Auto-clicker v2',       baseCost:600, costMult:1.17, type:'auto', amount:5,   desc:'+5 bytes/s',                 unlockEra:1 },
  { key:'evo_core',       icon:'🧬', name:'Evolución del Núcleo',  baseCost:1000,costMult:2.5,  type:'mult', amount:0.10,desc:'+10% a todo',                 unlockEra:1 }
];

const OBJECTIVES = [
  { id:'scrapers10', label:'Compra 10 Scrapers', get:()=>state.items.scraper?.qty||0, target:10 },
  { id:'gen1m', label:'Genera 1M bytes', get:()=>state.totalBytes, target:1e6 }
];

const ACHIEVEMENTS = [
  { id:'million', label:'Genera 1M bytes', cond:()=>state.totalBytes>=1e6 }
];

/* ===== Estado + migración ===== */
const $ = s => document.querySelector(s);
const fmt = Intl.NumberFormat('es-AR', { notation:'compact', maximumFractionDigits:2 });
let eventMult = 1;

function DEFAULT_STATE(){
  return {
    bytes:0, totalBytes:0,
    items:Object.fromEntries(ITEMS_DEF.map(d => [d.key, { qty:0 }])),
    era:0, bonus:0, log:[],
    objectives:{}, achievements:{},
  };
}
let state = DEFAULT_STATE();

function migrateState(s){
  s ||= {};
  s.items ||= {};
  for (const d of ITEMS_DEF) s.items[d.key] ||= {qty:0};
  s.objectives ||= {};
  s.achievements ||= {};
  s.bonus ||= 0;
  return s;
}

/* ===== Util ===== */
function costOf(def, qty){ return Math.floor(def.baseCost * Math.pow(def.costMult, qty)); }

function computeDerived(){
  let click=1, auto=0, mult=1;
  for (const def of ITEMS_DEF){
    const q = state.items[def.key]?.qty ?? 0;
    if (def.type==='click') click += q*def.amount;
    else if (def.type==='auto') auto += q*def.amount;
    else if (def.type==='mult') mult += q*def.amount;
  }
  const totalMult = mult + state.bonus;
  return { perClick:click*totalMult*eventMult, perSec:auto*totalMult*eventMult, mult:totalMult*eventMult };
}

function scheduleEvent(){
  const ms = 60000 + Math.random()*60000;
  setTimeout(triggerEvent, ms);
}

function triggerEvent(){
  const pool=[
    {mult:0.5, text:'Caída de servidores: producción -50% durante 30s', style:'bad'},
    {mult:2,   text:'Boom de datos: producción x2 durante 30s', style:'good'}
  ];
  const ev = pool[Math.floor(Math.random()*pool.length)];
  eventMult = ev.mult;
  pushMsg(ev.text, ev.style);
  setTimeout(()=>{ eventMult=1; pushMsg('Evento finalizado','small'); scheduleEvent(); },30000);
}

/* ===== DOM ===== */
const bytesEl=$('#bytes'), bpsEl=$('#bps'), perClickEl=$('#perClick'), multEl=$('#mult'),
      guiaEl=$('#guia'), objetivosEl=$('#objetivos'), eraLabel=$('#eraLabel'),
      clickBtn=$('#clickBtn'), itemsWrap=$('#items'), logWrap=$('#log'), resetBtn=$('#reset'),
      exportBtn=$('#export'), importBtn=$('#import'), fileInput=$('#fileInput'),
      themeBtn=$('#theme'), soundBtn=$('#sound'), achWrap=$('#achList'), achCard=$('#achCard'),
      storeEl=document.querySelector('.store');

/* ===== Render ===== */
function renderStore(){
  itemsWrap.innerHTML='';
  for (const def of ITEMS_DEF.filter(d => (d.unlockEra||0) <= state.era)){
    const row=document.createElement('div'); row.className='item'; row.dataset.key=def.key;
    const left=document.createElement('div');

    const h3=document.createElement('h3'); h3.textContent=`${def.icon} ${def.name}`;
    const desc=document.createElement('div'); desc.className='desc';
    const delta = def.type==='click' ? `+${def.amount} /clic`
               : def.type==='auto'  ? `+${def.amount} B/s`
                                     : `+${Math.round(def.amount*100)}% global`;
    desc.textContent = `${def.desc} (${delta})`;

    const meta=document.createElement('div'); meta.className='meta';
    left.append(h3, desc, meta);

    const btn=document.createElement('button'); btn.className='buy-btn'; btn.textContent='Comprar';
    btn.addEventListener('click', () => {
      const qty=state.items[def.key]?.qty ?? 0;
      const price=costOf(def, qty);
      if(state.bytes>=price){
        state.bytes-=price;
        state.items[def.key].qty=qty+1;
        save();
        updateAffordability();
        renderTopline();
        renderObjetivos();
        checkAchievements();
      }
    });

    row.append(left, btn);
    itemsWrap.append(row);
  }
  updateAffordability();
}

function updateAffordability(){
  document.querySelectorAll('.item').forEach(row=>{
    const key=row.dataset.key;
    const def=ITEMS_DEF.find(d=>d.key===key);
    const qty=state.items[key]?.qty ?? 0;
    const price=costOf(def, qty);
    row.querySelector('.meta').textContent = `Posees: ${qty} · Próximo costo: ${fmt.format(price)}`;
    row.querySelector('.buy-btn').disabled = state.bytes < price;
  });
}

function pushMsg(t, style=''){ state.log.push({t:Date.now(), text:t, style}); if(state.log.length>30) state.log = state.log.slice(-30); renderLog(); }
function renderLog(){
  logWrap.innerHTML='';
  for (const m of state.log.slice(-8)){
    const div=document.createElement('div'); div.className=`msg ${m.style||''}`; div.innerHTML=m.text; logWrap.append(div);
  }
  logWrap.scrollTop = logWrap.scrollHeight;
}

function currentEra(){ let e=0; for (const era of ERAS){ if (state.totalBytes >= era.threshold) e = era.id; } return e; }
function applyEraVisuals(id){
  const era = ERAS[id];
  document.body.style.background = era.bg;
  eraLabel.textContent = `— Era ${id}: ${era.name}`;
  guiaEl.textContent = era.hint;
  renderObjetivos();
}

function renderObjetivos(){
  objetivosEl.innerHTML='';
  const objs=[];
  const nextThr = ERAS[state.era+1]?.threshold;
  if(nextThr) objs.push({label:`Progreso hacia Era ${state.era+1}`, cur:state.totalBytes, target:nextThr});
  const d = computeDerived();
  if(d.perSec<1) objs.push({label:'Genera 1 byte/s', cur:d.perSec, target:1});
  const buyGoals=[
    {key:'scraper', label:'Compra un Scraper'},
    {key:'autoclicker_v2', label:'Compra Auto-clicker v2'},
    {key:'evo_core', label:'Compra Evolución del Núcleo'}
  ];
  for(const g of buyGoals){
    if((state.items[g.key]?.qty||0)===0){
      const def=ITEMS_DEF.find(d=>d.key===g.key);
      const price=costOf(def,state.items[g.key]?.qty||0);
      objs.push({label:g.label, cur:state.bytes, target:price, pulse:true});
      break;
    }
  }
  for(const obj of OBJECTIVES){
    if(state.objectives[obj.id]) continue;
    objs.push({label:obj.label, cur:obj.get(), target:obj.target, id:obj.id});
  }
  let pulse=false;
  for(const o of objs.slice(0,3)){
    const prog=Math.min(1,o.cur/o.target);
    const el=createObj(o.label, prog, `${fmt.format(o.cur)} / ${fmt.format(o.target)}`);
    objetivosEl.append(el);
    if(o.id && prog>=1){ state.objectives[o.id]=true; pushMsg(`Objetivo completado: ${o.label}`,'small'); save(); }
    if(o.pulse) pulse=true;
  }
  storeEl.classList.toggle('pulse', pulse);
}

function createObj(label, prog, text){
  const o=document.createElement('div'); o.className='objetivo';
  o.textContent=`${label}: ${text}`;
  const bar=document.createElement('div'); bar.className='barra';
  const fill=document.createElement('div'); fill.style.width=`${(prog*100).toFixed(0)}%`;
  bar.append(fill); o.append(bar); return o;
}

function renderAchievements(){
  achWrap.innerHTML='';
  let count=0;
  for (const a of ACHIEVEMENTS){
    if (state.achievements[a.id]){
      const div=document.createElement('div'); div.className='msg small';
      div.textContent=`🏆 ${a.label}`; achWrap.append(div); count++;
    }
  }
  if(!count) achWrap.textContent='Próximamente';
}

function checkAchievements(){
  for (const a of ACHIEVEMENTS){
    if (state.achievements[a.id]) continue;
    if (a.cond()){ state.achievements[a.id]=true; pushMsg(`Logro desbloqueado: ${a.label}`,'good'); renderAchievements(); save(); }
  }
}

function onboarding(){
  if(!localStorage.getItem('ob1')){ pushMsg('Haz clic para generar bytes.','small'); localStorage.setItem('ob1','1'); }
  setTimeout(()=>{ if(!localStorage.getItem('ob2')){ pushMsg('Compra un Scraper en la tienda.','small'); localStorage.setItem('ob2','1'); } },10000);
  setTimeout(()=>{ if(!localStorage.getItem('ob3')){ pushMsg('Revisa tus Objetivos.','small'); localStorage.setItem('ob3','1'); } },20000);
}

function maybeAdvanceEra(){
  const e = currentEra();
  if (e !== state.era){
    state.era = e;
    state.bonus = (state.bonus||0) + 0.10;
    applyEraVisuals(e);
    renderStore();
    pushMsg(`<em>${ERAS[e].intro}</em>`);
    save();
  }
}

function save(){ try{ localStorage.setItem('aiClickerSave', JSON.stringify(state)); }catch{} }
function load(){ try{ const raw = localStorage.getItem('aiClickerSave'); return raw ? JSON.parse(raw) : null; }catch{ return null; } }

function renderTopline(){
  const d = computeDerived();
  bytesEl.textContent = fmt.format(state.bytes);
  bpsEl.textContent   = fmt.format(d.perSec);
  perClickEl.textContent = fmt.format(d.perClick);
  multEl.textContent  = `x${d.mult.toFixed(2)}`;
}

function renderAll(){ renderTopline(); renderStore(); renderLog(); renderAchievements(); applyEraVisuals(state.era); updateAffordability(); }

/* ===== Interacciones ===== */
let sfxOn=false,lastSfx=0;
const sfx=new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=');
function playSfx(){
  const now=performance.now();
  if(!sfxOn||now-lastSfx<80) return;
  lastSfx=now; sfx.currentTime=0; sfx.play().catch(()=>{});
}

  function doClick(times=1){
    const { perClick } = computeDerived();
    const inc = perClick * times;
    state.bytes += inc; state.totalBytes += inc;
    renderTopline(); renderObjetivos(); checkAchievements();
  }

  let holdT=null, holdI=null;
  function startHold(){
    if(holdT) return;
    doClick(1); playSfx(); clickBtn.classList.add('click-pulse');
    setTimeout(()=>clickBtn.classList.remove('click-pulse'),150);
    holdT=setTimeout(()=>{ holdI=setInterval(()=>{doClick(1); playSfx();},70); },280);
  }
  function endHold(){ clearTimeout(holdT); holdT=null; clearInterval(holdI); holdI=null; }

  clickBtn.addEventListener('mousedown', startHold);
  window.addEventListener('mouseup', endHold);
  clickBtn.addEventListener('touchstart', e=>{ e.preventDefault(); startHold(); }, {passive:false});
  window.addEventListener('touchend', endHold);
  window.addEventListener('keydown', e => {
    if (e.code === 'Space' || e.code === 'Enter'){ e.preventDefault(); doClick(1); playSfx(); }
  });

resetBtn.addEventListener('click', () => {
  state = DEFAULT_STATE();
  save(); renderAll(); pushMsg('Progreso reiniciado.','small');
});

exportBtn.addEventListener('click', () => {
  const blob=new Blob([JSON.stringify(state)],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='ai-clicker-save.json'; a.click();
  setTimeout(()=>URL.revokeObjectURL(url),1000);
});

  importBtn.addEventListener('click', () => fileInput.click());
  fileInput.addEventListener('change', e => {
    const f=e.target.files[0]; if(!f) return;
    f.text().then(t=>{
      try{ state=migrateState(JSON.parse(t)); save(); renderAll(); pushMsg('Guardado importado.','small'); }
      catch{ pushMsg('Archivo inválido.','small'); }
    });
  });

  themeBtn.addEventListener('click', () => {
    document.body.classList.toggle('light');
    localStorage.setItem('theme', document.body.classList.contains('light')?'light':'dark');
  });
  soundBtn.addEventListener('click', () => {
    sfxOn = !sfxOn;
    localStorage.setItem('sfx', sfxOn?'on':'off');
    soundBtn.textContent = sfxOn ? 'Sonido: ON' : 'Sonido: OFF';
  });

/* ===== Boot ===== */
  (function init(){
    const saved = load();
    state = migrateState(saved || DEFAULT_STATE());
    if (localStorage.getItem('theme')==='light') document.body.classList.add('light');
    if (localStorage.getItem('sfx')==='on') sfxOn=true;
    soundBtn.textContent = sfxOn ? 'Sonido: ON' : 'Sonido: OFF';
    renderStore();
    renderTopline(); renderLog(); renderAchievements(); applyEraVisuals(state.era);
    updateAffordability();
    if (state.log.length === 0) pushMsg('Sistema online. Haz clic y compra mejoras para progresar.','small');
    checkAchievements();
    onboarding();
    setInterval(save, 5000);
    scheduleEvent();

    let last = performance.now();
    let uiAcc = 0;
    function loop(now){
      const dt = Math.min(0.25, (now - last) / 1000); last = now;
      const { perSec } = computeDerived();
      if (perSec > 0){ const inc=perSec*dt; state.bytes += inc; state.totalBytes += inc; }
      maybeAdvanceEra();
      uiAcc += dt;
      if (uiAcc >= 0.25){
        uiAcc = 0;
        renderTopline(); updateAffordability(); renderObjetivos(); checkAchievements();
      }
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);
  })();
</script>
</body>
</html>
